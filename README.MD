# Домашнее задание к занятию "10.1. Зачем и что нужно мониторить"
### Задание 1
```
Вас пригласили настроить мониторинг на проект. На онбординге вам рассказали, что проект представляет из себя платформу для вычислений с выдачей текстовых отчетов, которые сохраняются на диск. Взаимодействие с платформой осуществляется по протоколу http. Также вам отметили, что вычисления загружают ЦПУ. Какой минимальный набор метрик вы выведите в мониторинг и почему?
```
Ответ:
```
Для начала помним, что на надо собирать все подряд метрики (их смотреть никто не будет, среди них полезные не заметить можно), а только те, которые действительно нужны.
Исходя из условий задачи, если отчеты сохраняются на диск, то надо мониторить диски, как минимум место на дисках. Это чтобы вовремя узнать о том, что места мало и надо принять меры. Кроме того, может быть полезно знать показатели производительности диска, чтобы отловить момент, когда производительность проекта упрётся в производительность дисковой системы:
- время отклика диска (latency)
- число операций в секунду(IOPS)

Далее, раз вычисления грузят ЦПУ, то и надо знать, насколько загружен процессор и не надо ли добавить ресурсов.
Дополнительно интересна метрика iowait, которая подскажет, нет ли узкого места в операция ввода/вывода (это опять же вопрос к организации дисковой системы, кэша и сети). Добавляем также сбор сведений о нагрузке на сеть.

Если взаимодействие осуществляется по http, то обязательно надо получать сведения о доступности этой самой платформы. Для этого отлавиливаем ответы с кодом, отличным от 2xx и 3xx.
Кроме того, будем считать ответы 2xx и 3xx, чтобы оценить количество запросов у нашему сервису.
Ещё из этой серии надо включить время ответа сервиса, чтобы знать, как долго пользователям приходится ждать. Это тот самый black-box.

Далее, обязательно смотрим использование RAM, чтобы не пришел OOM и не убил наш сервис.
И последнее, что бы я добавил, это сбор сведений по inodes, чтобы понимать, во-первых, сколько этих самых отчетов, которые формирует сервис, уже есть, а во-вторых, не закончатся ли скорок inodes на файловой системе, поскольку отчеты текстовые формируются, они могут быть маленькими, а их количество очень большим.

К метрикам, показывающим использование памяти, доступность сервиса и число inodes надо привязать alertmanager, чтобы не допустить падение свервиса.
```

### Задание 2
```
Менеджер продукта посмотрев на ваши метрики сказал, что ему непонятно что такое RAM/inodes/CPUla. Также он сказал, что хочет понимать, насколько мы выполняем свои обязанности перед клиентами и какое качество обслуживания. Что вы можете ему предложить?
```
Ответ:
```
Просьба чётче формулировать задание. От меня требуется, чтобы я объяснил, что такое RAM/inodes/CPUla?

- RAM - объем оперативной памяти сервера. Если свободной памяти становится мало, то появится проблема со скоростью обслуживания клиентов как минимум, а как максимум падение сервиса из-за убйства процесса OOM killer. Анализируя динамику метрики можно спланировать, когда следует добавить память или вообще переехать на новое железо.

- inodes - количество файловых дескрипторов. По их числу можно судить о том, сколько сервис создал файлов с результатами. Если они закончатся, сервис не будет сохранять результаты своей работы. Следует отслеживать изменение числа inodes и своевременно добавить inodes, (добавить железо, оптимизировать ФС под хранение большого числа мелких файлов)

- CPUla - число процессов, готовых к исполнению. Если их меньше, чем ядер на хосте, то всё нормально. Если их больше, то сервис будет долго выполнять запросы пользователей, поскольку они будут висеть в очереди. Если такое наблюдаем, то надо увеличивать число ядер.

Все эти три показателя косвенно влияют на качество обслуживания клиентов и показывают в общем, достаточно ли мощности железа (параметров ВМ) для нормальной работы.

Однако для менеджера продукта стоит сделать отдельный dashboard, где бы показывалось как среднее время ответа приложения, количество ответов сервиса (сформированных отчетов), время доступа к сервису и текущая доступность сервиса. Если интересуют также показатели RAM/inodes/CPUla, можно туда добавить и их.
```
### Задание 3
```
Вашей DevOps команде в этом году не выделили финансирование на построение системы сбора логов. Разработчики в свою очередь хотят видеть все ошибки, которые выдают их приложения. Какое решение вы можете предпринять в этой ситуации, чтобы разработчики получали ошибки приложения?
```
Ответ:
```
Не понятен вопрос. Если совсем нет финансирования, то пусть разарбы  сами ходят туда, куда приложение складывает логи и смотрят их. А можно поставить Sentry. Это приложение - перехвтчик ошибок. Пусть им пользуются.
```

### Задание 4
```
Вы, как опытный SRE, сделали мониторинг, куда вывели отображения выполнения SLA=99% по http кодам ответов. Вычисляете этот параметр по следующей формуле: summ_2xx_requests/summ_all_requests. Данный параметр не поднимается выше 70%, но при этом в вашей системе нет кодов ответа 5xx и 4xx. Где у вас ошибка?
```
Ответ:
```
Так мерить нельзя, потому что есть ещё 3хх ответы (перенаправление). Правильно будет так: (summ_2xx_requests + summ_3xx_requests)/summ_all_requests
```